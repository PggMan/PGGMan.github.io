<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    

    <title>
      音视频 | 印度阿三 
    </title>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    
      <meta name="author" content="葛朋">
    
    

    <meta name="description" content="音视频 直播 直播流程：采集、处理、编码、推流、流分发、播放。  音视频采集 音视频的采集是直播架构的第一个环节、也是直播的视频来源 采集的来源包括； PC端：屏幕摄像头（摄像头驱动适配） iOS端：摄像头采集（前后摄像头采集） Android端：屏幕摄像头采集（硬件过多，适配一堆坑）    前处理 处理主要包括: 美颜、模糊效果、水印等 各个平台处理方法 PC端：美颜镜头、一些美颜软件 iOS端">
<meta name="keywords" content="iOS">
<meta property="og:type" content="article">
<meta property="og:title" content="音视频 | 印度阿三">
<meta property="og:url" content="http://PGGMan.github.io/2018/07/21/音视频/index.html">
<meta property="og:site_name" content="印度阿三">
<meta property="og:description" content="音视频 直播 直播流程：采集、处理、编码、推流、流分发、播放。  音视频采集 音视频的采集是直播架构的第一个环节、也是直播的视频来源 采集的来源包括； PC端：屏幕摄像头（摄像头驱动适配） iOS端：摄像头采集（前后摄像头采集） Android端：屏幕摄像头采集（硬件过多，适配一堆坑）    前处理 处理主要包括: 美颜、模糊效果、水印等 各个平台处理方法 PC端：美颜镜头、一些美颜软件 iOS端">
<meta property="og:locale" content="Chinese/English">
<meta property="og:image" content="http://pggman.github.io/2018/07/21/音视频/my_map.png">
<meta property="og:updated_time" content="2018-07-29T10:38:09.144Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="音视频 | 印度阿三">
<meta name="twitter:description" content="音视频 直播 直播流程：采集、处理、编码、推流、流分发、播放。  音视频采集 音视频的采集是直播架构的第一个环节、也是直播的视频来源 采集的来源包括； PC端：屏幕摄像头（摄像头驱动适配） iOS端：摄像头采集（前后摄像头采集） Android端：屏幕摄像头采集（硬件过多，适配一堆坑）    前处理 处理主要包括: 美颜、模糊效果、水印等 各个平台处理方法 PC端：美颜镜头、一些美颜软件 iOS端">
<meta name="twitter:image" content="http://pggman.github.io/2018/07/21/音视频/my_map.png">
    
    
    
      <link rel="icon" type="image/x-icon" href="/favicon.png">
    
    <link rel="stylesheet" href="/css/uno.css">
    <link rel="stylesheet" href="/css/highlight.css">
    <link rel="stylesheet" href="/css/archive.css">
    <link rel="stylesheet" href="/css/china-social-icon.css">

</head>
<body>

    <span class="mobile btn-mobile-menu">
        <i class="icon icon-list btn-mobile-menu__icon"></i>
        <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
    </span>

    

<header class="panel-cover panel-cover--collapsed">


  <div class="panel-main">

  
    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        

        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage">印度阿三</a></h1>
        <hr class="panel-cover__divider" />

        
        <p class="panel-cover__description">
          I&#39;m my own hero
        </p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />
        

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">

              
                
                <li class="navigation__item"><a href="/#blog" title="" class="blog-button">首页</a></li>
              

            </ul>
          </nav>

          <!-- ----------------------------
To add a new social icon simply duplicate one of the list items from below
and change the class in the <i> tag to match the desired social network
and then add your link to the <a>. Here is a full list of social network
classes that you can use:

    icon-social-500px
    icon-social-behance
    icon-social-delicious
    icon-social-designer-news
    icon-social-deviant-art
    icon-social-digg
    icon-social-dribbble
    icon-social-facebook
    icon-social-flickr
    icon-social-forrst
    icon-social-foursquare
    icon-social-github
    icon-social-google-plus
    icon-social-hi5
    icon-social-instagram
    icon-social-lastfm
    icon-social-linkedin
    icon-social-medium
    icon-social-myspace
    icon-social-path
    icon-social-pinterest
    icon-social-rdio
    icon-social-reddit
    icon-social-skype
    icon-social-spotify
    icon-social-stack-overflow
    icon-social-steam
    icon-social-stumbleupon
    icon-social-treehouse
    icon-social-tumblr
    icon-social-twitter
    icon-social-vimeo
    icon-social-xbox
    icon-social-yelp
    icon-social-youtube
    icon-social-zerply
    icon-mail

-------------------------------->

<!-- add social info here -->



        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner entry">
            

<article class="post-container post-container--single">

  <header class="post-header">
    
    <h1 class="post-title">音视频</h1>

    

    <div class="post-meta">
      <time datetime="2018-07-21" class="post-meta__date date">2018-07-21</time> 

      <span class="post-meta__tags tags">

          

          

      </span>
    </div>
    
    

  </header>

  <section id="post-content" class="article-content post">
    <h2 id="音视频"><a href="#音视频" class="headerlink" title="音视频 "></a><font color="#037aff" face="黑体">音视频 </font></h2><h4 id="直播"><a href="#直播" class="headerlink" title="直播"></a>直播</h4><ul>
<li>直播流程：<code>采集</code>、<code>处理</code>、<code>编码</code>、<code>推流</code>、<code>流分发</code>、<code>播放</code>。<br><img src="/2018/07/21/音视频/my_map.png" alt="图片生成流程"></li>
</ul>
<h4 id="音视频采集"><a href="#音视频采集" class="headerlink" title="音视频采集"></a><code>音视频采集</code></h4><ul>
<li>音视频的采集是直播架构的第一个环节、也是直播的视频来源</li>
<li>采集的来源包括；<ul>
<li>PC端：屏幕摄像头（摄像头驱动适配）</li>
<li>iOS端：摄像头采集（前后摄像头采集）</li>
<li>Android端：屏幕摄像头采集（硬件过多，适配一堆坑）</li>
</ul>
</li>
</ul>
<h4 id="前处理"><a href="#前处理" class="headerlink" title="前处理"></a><code>前处理</code></h4><ul>
<li>处理主要包括: 美颜、模糊效果、水印等</li>
<li>各个平台处理方法<ul>
<li>PC端：美颜镜头、一些美颜软件</li>
<li>iOS端：图像处理库是GPUImage，提供了丰富的预处理效果，也可利用该库自定义设计</li>
<li>Android端：Google开源的grafika，是一个非常强大的图形处理库</li>
</ul>
</li>
</ul>
<h4 id="编码"><a href="#编码" class="headerlink" title="编码"></a><code>编码</code></h4><ul>
<li>没经过编码的视频非常庞大，存储起来都麻烦，更何况网络传输<ul>
<li>编码通过压缩<code>音视频</code>数据来减少体积，方便<code>音视频</code>数据的推流、拉流和存储，能大大提高存储和传输效率</li>
<li><code>音视频</code>必须经过压缩编码才能进行存储和传输</li>
</ul>
</li>
<li>各个平台处理：<ul>
<li>iOS端：硬件性能好，可以直接进行硬编码</li>
<li>Android端：硬编码较难，难找到同一的库兼容各个平台（推荐使用软编码）</li>
</ul>
</li>
<li>编码标砖：<ul>
<li>视频编码：H.265、<code>H.264</code>、VP8、VP9等</li>
<li>音频编码：AAC（高级音频编码，目的是取代MP3格式）、Opus</li>
</ul>
</li>
</ul>
<h4 id="传输"><a href="#传输" class="headerlink" title="传输"></a><code>传输</code></h4><ul>
<li><p>从推流端到服务端</p>
<ul>
<li>数据经过推流端采集和预处理，编码之后推流到服务端</li>
<li>流传输就涉及到相应的传输协议，最常用的协议是RTMP、RTSP、HLS、        <h4 id="流分发"><a href="#流分发" class="headerlink" title="流分发"></a><code>流分发</code></h4></li>
</ul>
</li>
<li><p>音频流推到服务器后，为了适配各个平台端各种不同协议，需要在服务端做一些流处理工作。比如转码成不同格式支持不同协议如<code>RTMP</code>、<code>HLS</code>、<code>FLV</code>。以适应各个平台。</p>
<ul>
<li>比如：iOS、Android、PC、网页 </li>
</ul>
</li>
</ul>
<h4 id="播放"><a href="#播放" class="headerlink" title="播放"></a><code>播放</code></h4><ul>
<li>拉流获取音视频数据后，需要通过解码器解码，渲染才能在播放器上播放。</li>
<li>总体步骤概览：<ul>
<li>解协议：去除网络传输过程中一些无用信息</li>
<li>解封装：获取到的是音频&amp;视频放在一起的封装文件</li>
<li>音视频解码：音视频都是经过压缩编码的内容，解码后才能进行播放</li>
<li>音视频同步：视频&amp;音频文件需要同步播放</li>
<li>音视频播放：声卡&amp;显卡等对音视频进行播放。   </li>
</ul>
</li>
</ul>
<h2 id="采集音视频"><a href="#采集音视频" class="headerlink" title="采集音视频"></a><font color="#037aff" face="黑体">采集音视频</font></h2><ul>
<li>音视频采集是直播架构的第一环节，是视频的来源,    框架主要是<code>AVFoundation</code>和<code>CoreMedia</code>,包括视频输出、输入和文件的读写<ul>
<li>其实视频的采集有多个应用场景：比如二维码开发、直播</li>
</ul>
</li>
<li>音视频采集包括两部分<ul>
<li>视频采集</li>
<li>音频采集</li>
</ul>
</li>
<li>在iOS开发中，是可以同步采集视频&amp;音频的，使用方式也非常简单</li>
<li>相关的采集API都封装在AVFoundation框架中，导入对应框架，实现功能即可</li>
</ul>
<h4 id="主要API"><a href="#主要API" class="headerlink" title="主要API"></a>主要API</h4><ul>
<li><code>AVCaptureSession</code>：回话  </li>
<li><code>AVCaptureDevice</code>： 设备</li>
<li><code>AVCaptureDeviceInput</code>: 输入设备</li>
<li><code>AVCaptureVideoDataOutput</code>：视频输出设备</li>
<li><code>AVCaptureAudioDataOutput</code>：音频输出设备</li>
<li><code>AVCaptureConnection</code>：输入与输出桥接</li>
<li><code>AVAssetWriter</code>：数据写入工具类</li>
<li><code>AVAssetWriterInput</code>：</li>
<li><code>AVCaptureVideoPreviewLayer</code>：预览视图</li>
</ul>
<h4 id="AVCaptureSession"><a href="#AVCaptureSession" class="headerlink" title="AVCaptureSession"></a><code>AVCaptureSession</code></h4><ul>
<li><code>AVCaptureSession</code>是<code>AVFoundation</code>捕捉类的中心枢纽，在视频捕获时,客户端可以实例化<code>AVCaptureSession</code>并添加适当的AVCaptureInputs、AVCaptureDeviceInput和输出，比如AVCaptureMovieFileOutput。通过[AVCaptureSession startRunning]开始数据流从输入到输出,和[AVCaptureSession stopRunning]停止输出输入的流动。客户端可以通过设置sessionPreset属性定制录制质量水平或输出的分辨率。</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- (<span class="built_in">AVCaptureSession</span> *)addCaptureSession&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">AVCaptureSession</span> *session = [[<span class="built_in">AVCaptureSession</span> alloc] init];</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     AVCaptureSessionPresetHigh :</span></span><br><span class="line"><span class="comment">     [默认值] 高分辨率，会根据当前设备进行自适应</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    session.sessionPreset = <span class="built_in">AVCaptureSessionPresetHigh</span>;</span><br><span class="line">    _session = session;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> session;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="AVCaptureDevice"><a href="#AVCaptureDevice" class="headerlink" title="AVCaptureDevice"></a><code>AVCaptureDevice</code></h4><ul>
<li><code>AVCaptureDevice</code>的每个实例对应一个设备，如摄像头或麦克风。<code>AVCaptureDevice</code>的实例不能直接创建。所有现有设备可以使用类方法<code>devicesWithMediaType:defaultDeviceWithMediaType:</code>获取，设备可以提供一个或多个给定流媒体类型。<code>AVCaptureDevice</code>实例可用于提供给<code>AVCaptureSession</code>创建一个为<code>AVCaptureDeviceInput</code>类型的输入源。</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- (<span class="built_in">AVCaptureDevice</span> *)addCaptureDevice:(<span class="built_in">AVCaptureSession</span> *)session&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2 创建Device</span></span><br><span class="line">    <span class="built_in">AVCaptureDevice</span> *device = [<span class="built_in">AVCaptureDevice</span> defaultDeviceWithMediaType:<span class="built_in">AVMediaTypeVideo</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> ([device lockForConfiguration:<span class="literal">nil</span>]) &#123;</span><br><span class="line">        <span class="comment">//自动闪光灯，</span></span><br><span class="line">        <span class="keyword">if</span> ([device isFlashModeSupported:<span class="built_in">AVCaptureFlashModeAuto</span>]) &#123;</span><br><span class="line">            [device setFlashMode:<span class="built_in">AVCaptureFlashModeAuto</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 帧率 1秒10帧</span></span><br><span class="line">        device.activeVideoMinFrameDuration = <span class="built_in">CMTimeMake</span>(<span class="number">1</span>, <span class="number">10</span>);</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">//自动白平衡,</span></span><br><span class="line">        <span class="keyword">if</span> ([device isWhiteBalanceModeSupported:<span class="built_in">AVCaptureWhiteBalanceModeContinuousAutoWhiteBalance</span>]) &#123;</span><br><span class="line">            [device setWhiteBalanceMode:<span class="built_in">AVCaptureWhiteBalanceModeContinuousAutoWhiteBalance</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        [device unlockForConfiguration];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     AVMediaTypeVideo:    摄像头,</span></span><br><span class="line"><span class="comment">     AVMediaTypeAudio:    话筒,</span></span><br><span class="line"><span class="comment">     AVMediaTypeMuxed:    弹幕,</span></span><br><span class="line"><span class="comment">     AVMediaTypeSubtitle:  字幕,</span></span><br><span class="line"><span class="comment">     AVMediaTypeTimecode</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">return</span> device;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="AVCaptureDeviceInput"><a href="#AVCaptureDeviceInput" class="headerlink" title="AVCaptureDeviceInput"></a><code>AVCaptureDeviceInput</code></h4><ul>
<li><code>AVCaptureDeviceInput</code> 是<code>AVCaptureSession</code>输入源,提供媒体数据从设备连接到系统，通过<code>AVCaptureDevice</code>的实例化得到，就是我们将要用到的设备输出源设备，也就是前后摄像头，通过<code>[AVCaptureDevice devicesWithMediaType:AVMediaTypeVideo]</code>方法获得。</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)addCaptureDeviceInput:(<span class="built_in">AVCaptureDevice</span> *)device&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//3 创建输入源并添加到回话中</span></span><br><span class="line">    <span class="built_in">NSError</span> *error;</span><br><span class="line">    <span class="built_in">AVCaptureDeviceInput</span> *input =  [<span class="built_in">AVCaptureDeviceInput</span> deviceInputWithDevice:device error:&amp;error];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(input) &#123;</span><br><span class="line">        [_session addInput:input];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, error);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="AVCaptureMovieFileOutput"><a href="#AVCaptureMovieFileOutput" class="headerlink" title="AVCaptureMovieFileOutput"></a><code>AVCaptureMovieFileOutput</code></h4><ul>
<li><code>AVCaptureMovieFileOutput</code>是<code>AVCaptureFileOutput</code>的子类，用来写入QuickTime视频类型的媒体文件。因为这个类在iphone上并不能实现暂停录制，和不能定义视频文件的类型，所以在这里并不使用，而是用灵活性更强的<code>AVCaptureVideoDataOutput</code>和<code>AVCaptureAudioDataOutput</code>来实现视频的录制。</li>
</ul>
<h4 id="AVCaptureVideoDataOutput"><a href="#AVCaptureVideoDataOutput" class="headerlink" title="AVCaptureVideoDataOutput"></a><code>AVCaptureVideoDataOutput</code></h4><ul>
<li><code>AVCaptureVideoDataOutput</code>是<code>AVCaptureOutput</code>一个子类，可以用于用来输出未压缩或压缩的视频捕获的帧，<code>AVCaptureVideoDataOutput</code>产生的实例可以使用其他媒体视频帧适合的api处理，应用程序可以用<code>captureOutput:didOutputSampleBuffer:fromConnection:</code>代理方法来获取帧数据。</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)addCaptureDeviceOutput:(<span class="built_in">AVCaptureDevice</span> *)device&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//4 创建输出源并添加到回话中</span></span><br><span class="line">    <span class="comment">//output</span></span><br><span class="line">    <span class="built_in">AVCaptureVideoDataOutput</span> *output = [[<span class="built_in">AVCaptureVideoDataOutput</span> alloc] init];</span><br><span class="line">    [_session addOutput:output];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//4.1 设置输出代理</span></span><br><span class="line">    [output setSampleBufferDelegate:<span class="keyword">self</span></span><br><span class="line">                              queue:dispatch_queue_create(<span class="string">"LinXunFengSerialQueue"</span>, DISPATCH_QUEUE_SERIAL)];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//4.2 输出信息设置</span></span><br><span class="line">    <span class="comment">// kCVPixelFormatType_420YpCbCr8BiPlanarVideoRange 输出格式和范围</span></span><br><span class="line">    <span class="comment">// kCVPixelBufferPixelFormatTypeKey 指定像素输出格式</span></span><br><span class="line">    <span class="built_in">NSDictionary</span>* setcapSettings = [<span class="built_in">NSDictionary</span> dictionaryWithObjectsAndKeys:</span><br><span class="line">                                    [<span class="built_in">NSNumber</span> numberWithInt:kCVPixelFormatType_420YpCbCr8BiPlanarVideoRange], kCVPixelBufferPixelFormatTypeKey,</span><br><span class="line">                                    <span class="literal">nil</span>];</span><br><span class="line">    output.videoSettings = setcapSettings;</span><br><span class="line">    <span class="comment">//4.2 获取输入与输出之间的连接 设置</span></span><br><span class="line">    [<span class="keyword">self</span> setConnection:output];</span><br><span class="line">   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 代理 获得的是CGImage</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> CMSampleBufferRef: 帧缓存数据，描述当前帧信息</span></span><br><span class="line"><span class="comment"> 获取帧缓存信息 : CMSampleBufferGet</span></span><br><span class="line"><span class="comment"> CMSampleBufferGetDuration : 获取当前帧播放时间</span></span><br><span class="line"><span class="comment"> CMSampleBufferGetImageBuffer : 获取当前帧图片信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// CoreImage: 底层绘制图片</span></span><br><span class="line"><span class="comment">// 获取帧数据</span></span><br><span class="line">- (<span class="keyword">void</span>)captureOutput:(<span class="built_in">AVCaptureOutput</span> *)output didOutputSampleBuffer:(<span class="built_in">CMSampleBufferRef</span>)sampleBuffer fromConnection:(<span class="built_in">AVCaptureConnection</span> *)connection &#123;</span><br><span class="line">    <span class="comment">// captureSession 会话如果没有强引用，这里不会得到执行</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取图片帧数据</span></span><br><span class="line">    CVImageBufferRef imageBuffer = <span class="built_in">CMSampleBufferGetImageBuffer</span>(sampleBuffer);</span><br><span class="line">    <span class="built_in">CIImage</span> *ciImage = [<span class="built_in">CIImage</span> imageWithCVImageBuffer:imageBuffer];</span><br><span class="line">    <span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageWithCIImage:ciImage];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        <span class="keyword">self</span>.imageView.image = image;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="AVCaptureAudioDataOutput"><a href="#AVCaptureAudioDataOutput" class="headerlink" title="AVCaptureAudioDataOutput"></a><code>AVCaptureAudioDataOutput</code></h4><ul>
<li><code>AVCaptureAudioDataOutput</code>是<code>AVCaptureOutput</code>的子类，可用于用来输出捕获来的非压缩或压缩的<code>音频</code>样本，<code>AVCaptureAudioDataOutput</code>产生的实例可以使用其他媒体视频帧适合的api处理，应用程序可以用<code>captureOutput:didOutputSampleBuffer:fromConnection:</code>代理方法来获取音频数据。</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">AVCaptureAudioDataOutput</span> *)audioOutput &#123;</span><br><span class="line">    <span class="keyword">if</span> (_audioOutput == <span class="literal">nil</span>) &#123;</span><br><span class="line">        _audioOutput = [[<span class="built_in">AVCaptureAudioDataOutput</span> alloc] init];</span><br><span class="line">        [_audioOutput setSampleBufferDelegate:<span class="keyword">self</span> queue:<span class="keyword">self</span>.captureQueue];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _audioOutput;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 代理如上 AVCaptureVideoDataOutput</span></span><br></pre></td></tr></table></figure>
<h4 id="AVCaptureConnection"><a href="#AVCaptureConnection" class="headerlink" title="AVCaptureConnection"></a><code>AVCaptureConnection</code></h4><ul>
<li><code>AVCaptureConnection</code>代表<code>AVCaptureInputPort</code>或端口之间的连接，和一个<code>AVCaptureOutput</code>或<code>AVCaptureVideoPreviewLayer</code>在<code>AVCaptureSession</code>中的呈现。</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 注意： 一定要在添加之后</span></span><br><span class="line"> <span class="comment">// 获取输入与输出之间的连接</span></span><br><span class="line"> <span class="built_in">AVCaptureConnection</span> *connection = [output connectionWithMediaType:<span class="built_in">AVMediaTypeVideo</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="comment">// 设置采集数据的方向、镜像</span></span><br><span class="line"> connection.videoOrientation = <span class="built_in">AVCaptureVideoOrientationPortrait</span>;</span><br><span class="line"> <span class="comment">//connection.videoMirrored = YES;</span></span><br></pre></td></tr></table></figure>
<h4 id="AVCaptureVideoPreviewLayer"><a href="#AVCaptureVideoPreviewLayer" class="headerlink" title="AVCaptureVideoPreviewLayer"></a><code>AVCaptureVideoPreviewLayer</code></h4><ul>
<li>是<code>CoreAnimation</code>里面layer的一个子类，用来做为<code>AVCaptureSession</code>预览视频输出，简单来说就是来做为拍摄的视频呈现的一个layer。</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">AVCaptureVideoPreviewLayer</span> *)previewLayer &#123;</span><br><span class="line">    <span class="keyword">if</span> (_previewLayer == <span class="literal">nil</span>) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">AVCaptureVideoPreviewLayer</span> *preview = [[<span class="built_in">AVCaptureVideoPreviewLayer</span> alloc] initWithSession:<span class="keyword">self</span>.session];</span><br><span class="line">        </span><br><span class="line">        preview.videoGravity = <span class="built_in">AVLayerVideoGravityResizeAspectFill</span>;</span><br><span class="line">        _previewLayer = preview;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _previewLayer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="AVAssetWriter"><a href="#AVAssetWriter" class="headerlink" title="AVAssetWriter"></a><code>AVAssetWriter</code></h4><ul>
<li><code>AVAssetWriter</code>为写入媒体数据到一个新的文件提供服务，<code>AVAssetWriter</code>的实例可以规定写入媒体文件的格式，如QuickTime电影文件格式或MPEG-4文件格式等等。<code>AVAssetWriter</code>有多个并行的轨道媒体数据，基本的有视频轨道和音频轨道，将会在下面介绍。<code>AVAssetWriter</code>的单个实例可用于一次写入一个单一的文件。那些希望写入多次文件的客户端必须每一次用一个新的AVAssetWriter实例。</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)initPath:(<span class="built_in">NSString</span>*)path Height:(<span class="built_in">NSInteger</span>)cy width:(<span class="built_in">NSInteger</span>)cx channels:(<span class="keyword">int</span>)ch samples:(Float64) rate &#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.path = path;</span><br><span class="line">        </span><br><span class="line">        [[<span class="built_in">NSFileManager</span> defaultManager] removeItemAtPath:<span class="keyword">self</span>.path error:<span class="literal">nil</span>];</span><br><span class="line">        <span class="built_in">NSURL</span>* url = [<span class="built_in">NSURL</span> fileURLWithPath:<span class="keyword">self</span>.path];</span><br><span class="line">        </span><br><span class="line">        _writer = [<span class="built_in">AVAssetWriter</span> assetWriterWithURL:url fileType:<span class="built_in">AVFileTypeMPEG4</span> error:<span class="literal">nil</span>];</span><br><span class="line">        </span><br><span class="line">        _writer.shouldOptimizeForNetworkUse = <span class="literal">YES</span>;</span><br><span class="line">        </span><br><span class="line">        [<span class="keyword">self</span> initVideoInputHeight:cy width:cx];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (rate != <span class="number">0</span> &amp;&amp; ch != <span class="number">0</span>) &#123;</span><br><span class="line">            </span><br><span class="line">            [<span class="keyword">self</span> initAudioInputChannels:ch samples:rate];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="AVAssetWriterInput"><a href="#AVAssetWriterInput" class="headerlink" title="AVAssetWriterInput"></a><code>AVAssetWriterInput</code></h4><ul>
<li>用<code>AVAssetWriterInput</code>去拼接一个多媒体样本类型为<code>CMSampleBuffer</code>(outout代理提供的类型)的实例到<code>AVAssetWriter</code>对象的输出文件的一个轨道；当有多个输入时， AVAssetWriter试图在用于存储和播放效率的理想模式写媒体数据。它的每一个输入信号，是否能接受媒体的数据根据通过<code>readyForMoreMediaData</code>的值来判断。如果<code>readyForMoreMediaData</code>是<code>YES</code> ，说明输入可以接受媒体数据。并且你只能媒体数据追加到输入端。</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)initVideoInputHeight:(<span class="built_in">NSInteger</span>)cy width:(<span class="built_in">NSInteger</span>)cx &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSDictionary</span>* settings = [<span class="built_in">NSDictionary</span> dictionaryWithObjectsAndKeys:</span><br><span class="line">                              <span class="built_in">AVVideoCodecH264</span>, <span class="built_in">AVVideoCodecKey</span>,</span><br><span class="line">                              [<span class="built_in">NSNumber</span> numberWithInteger: cx], <span class="built_in">AVVideoWidthKey</span>,</span><br><span class="line">                              [<span class="built_in">NSNumber</span> numberWithInteger: cy], <span class="built_in">AVVideoHeightKey</span>,</span><br><span class="line">                              <span class="literal">nil</span>];</span><br><span class="line">    </span><br><span class="line">    _videoInput = [<span class="built_in">AVAssetWriterInput</span> assetWriterInputWithMediaType:<span class="built_in">AVMediaTypeVideo</span> outputSettings:settings];</span><br><span class="line">    </span><br><span class="line">    _videoInput.expectsMediaDataInRealTime = <span class="literal">YES</span>;</span><br><span class="line">    </span><br><span class="line">    [_writer addInput:_videoInput];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)initAudioInputChannels:(<span class="keyword">int</span>)ch samples:(Float64)rate &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSDictionary</span> *settings = [<span class="built_in">NSDictionary</span> dictionaryWithObjectsAndKeys:</span><br><span class="line">                              [ <span class="built_in">NSNumber</span> numberWithInt: kAudioFormatMPEG4AAC], <span class="built_in">AVFormatIDKey</span>,</span><br><span class="line">                              [ <span class="built_in">NSNumber</span> numberWithInt: ch], <span class="built_in">AVNumberOfChannelsKey</span>,</span><br><span class="line">                              [ <span class="built_in">NSNumber</span> numberWithFloat: rate], <span class="built_in">AVSampleRateKey</span>,</span><br><span class="line">                              [ <span class="built_in">NSNumber</span> numberWithInt: <span class="number">128000</span>], <span class="built_in">AVEncoderBitRateKey</span>,</span><br><span class="line">                              <span class="literal">nil</span>];</span><br><span class="line">    </span><br><span class="line">    _audioInput = [<span class="built_in">AVAssetWriterInput</span> assetWriterInputWithMediaType:<span class="built_in">AVMediaTypeAudio</span> outputSettings:settings];</span><br><span class="line">    </span><br><span class="line">    _audioInput.expectsMediaDataInRealTime = <span class="literal">YES</span>;</span><br><span class="line">    </span><br><span class="line">    [_writer addInput:_audioInput];</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="采集步骤"><a href="#采集步骤" class="headerlink" title="采集步骤"></a>采集步骤</h4><ul>
<li>PS：如果做过二维码开发、应该对相关操作非常数据（非常类似）</li>
<li>导入框架<ul>
<li>相关API主要在AVFoundation框架中，因此需要先导入框架  </li>
</ul>
</li>
<li>创建捕捉回话    (AVCaptureSession)<ul>
<li>该回话适用于连接之后的输入源&amp;输出源</li>
<li>输入源：摄像头&amp;话筒</li>
<li>输出源：拿到对应的音频&amp;视频</li>
<li>回话：用于将输入源&amp;输出源连接起来 </li>
</ul>
</li>
<li>设置视频输入源&amp;输出源<ul>
<li>输入源：（AVCaptureDeviceInput）：从摄像头输入</li>
<li>输出源：(AVCaptureAudioDataOutput）：可以设置代理，在代理方法中拿到数据</li>
<li>将输入&amp;输出添加到回话中     </li>
</ul>
</li>
<li>添加预览图层 (AVCaptureVideoPreviewLayer)（可选）<ul>
<li>如果希望用户看到采集的画面，可以添加预览图层</li>
<li>该预览图层不是必须的，即使没有添加也可以正常采集数据。</li>
</ul>
</li>
<li>开始采集即可<ul>
<li>调用会话（AVCaptureSession）的startRunning方法即可开始采集。</li>
</ul>
</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  ViewController.m</span></span><br><span class="line"><span class="comment">//  VideoDemo</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by 印度阿三 on 2018/7/23.</span></span><br><span class="line"><span class="comment">//  Copyright © 2018年 印度阿三. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;AVFoundation/AVFoundation.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()&lt;<span class="title">AVCaptureVideoDataOutputSampleBufferDelegate</span>&gt;</span></span><br><span class="line"><span class="comment">/** 必须进行强引用*/</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span> ,<span class="keyword">strong</span>)  <span class="built_in">AVCaptureSession</span> *session;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span> ,<span class="keyword">weak</span>)  <span class="built_in">AVCaptureVideoPreviewLayer</span> *previewLayer;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span> ,<span class="keyword">weak</span>) <span class="built_in">UIImageView</span> *imageView;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UIImageView</span> *)imageView&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_imageView) &#123;</span><br><span class="line">        <span class="built_in">UIImageView</span>  *imageView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="keyword">self</span>.view.bounds];</span><br><span class="line">        [<span class="keyword">self</span>.view addSubview:imageView];</span><br><span class="line">        _imageView = imageView;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> _imageView;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">//1 创建回话</span></span><br><span class="line">    <span class="built_in">AVCaptureSession</span> *session = [<span class="keyword">self</span> addCaptureSession];</span><br><span class="line">    <span class="comment">//2 获取音视频设备</span></span><br><span class="line">    <span class="built_in">AVCaptureDevice</span> *device   = [<span class="keyword">self</span> addCaptureDevice:session];</span><br><span class="line">    <span class="comment">//3 输入设备</span></span><br><span class="line">    [<span class="keyword">self</span> addCaptureDeviceInput:device];</span><br><span class="line">    <span class="comment">//4 输出设备</span></span><br><span class="line">    [<span class="keyword">self</span> addCaptureDeviceOutput:device];</span><br><span class="line">    <span class="comment">//start</span></span><br><span class="line">    [session startRunning];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">AVCaptureSession</span> *)addCaptureSession&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">AVCaptureSession</span> *session = [[<span class="built_in">AVCaptureSession</span> alloc] init];</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     AVCaptureSessionPresetHigh :</span></span><br><span class="line"><span class="comment">     [默认值] 高分辨率，会根据当前设备进行自适应</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    session.sessionPreset = <span class="built_in">AVCaptureSessionPresetHigh</span>;</span><br><span class="line">    _session = session;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> session;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">AVCaptureDevice</span> *)addCaptureDevice:(<span class="built_in">AVCaptureSession</span> *)session&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//2 创建Device</span></span><br><span class="line">    <span class="built_in">AVCaptureDevice</span> *device = [<span class="built_in">AVCaptureDevice</span> defaultDeviceWithMediaType:<span class="built_in">AVMediaTypeVideo</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> ([device lockForConfiguration:<span class="literal">nil</span>]) &#123;</span><br><span class="line">        <span class="comment">//自动闪光灯，</span></span><br><span class="line">        <span class="keyword">if</span> ([device isFlashModeSupported:<span class="built_in">AVCaptureFlashModeAuto</span>]) &#123;</span><br><span class="line">            [device setFlashMode:<span class="built_in">AVCaptureFlashModeAuto</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 帧率 1秒10帧</span></span><br><span class="line">        device.activeVideoMinFrameDuration = <span class="built_in">CMTimeMake</span>(<span class="number">1</span>, <span class="number">10</span>);</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">//自动白平衡,</span></span><br><span class="line">        <span class="keyword">if</span> ([device isWhiteBalanceModeSupported:<span class="built_in">AVCaptureWhiteBalanceModeContinuousAutoWhiteBalance</span>]) &#123;</span><br><span class="line">            [device setWhiteBalanceMode:<span class="built_in">AVCaptureWhiteBalanceModeContinuousAutoWhiteBalance</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        [device unlockForConfiguration];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> device;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)addCaptureDeviceInput:(<span class="built_in">AVCaptureDevice</span> *)device&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//3 创建输入源并添加到回话中</span></span><br><span class="line">    <span class="built_in">NSError</span> *error;</span><br><span class="line">    <span class="built_in">AVCaptureDeviceInput</span> *input =  [<span class="built_in">AVCaptureDeviceInput</span> deviceInputWithDevice:device error:&amp;error];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(input) &#123;</span><br><span class="line">        [_session addInput:input];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, error);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)addCaptureDeviceOutput:(<span class="built_in">AVCaptureDevice</span> *)device&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//4 创建输出源并添加到回话中</span></span><br><span class="line">    <span class="comment">//output</span></span><br><span class="line">    <span class="built_in">AVCaptureVideoDataOutput</span> *output = [[<span class="built_in">AVCaptureVideoDataOutput</span> alloc] init];</span><br><span class="line">    [_session addOutput:output];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//4.1 设置输出代理</span></span><br><span class="line">    <span class="built_in">dispatch_queue_t</span> queue = dispatch_queue_create(<span class="string">"LinXunFengSerialQueue"</span>, DISPATCH_QUEUE_SERIAL);</span><br><span class="line">    </span><br><span class="line">    [output setSampleBufferDelegate:<span class="keyword">self</span> queue:queue];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//4.2 输出信息设置</span></span><br><span class="line">    <span class="comment">// kCVPixelFormatType_420YpCbCr8BiPlanarVideoRange 输出格式和范围</span></span><br><span class="line">    <span class="comment">// kCVPixelBufferPixelFormatTypeKey 指定像素输出格式</span></span><br><span class="line">    <span class="built_in">NSDictionary</span>* setcapSettings = [<span class="built_in">NSDictionary</span> dictionaryWithObjectsAndKeys:</span><br><span class="line">                                    [<span class="built_in">NSNumber</span> numberWithInt:kCVPixelFormatType_420YpCbCr8BiPlanarVideoRange], kCVPixelBufferPixelFormatTypeKey,</span><br><span class="line">                                    <span class="literal">nil</span>];</span><br><span class="line">    output.videoSettings = setcapSettings;</span><br><span class="line">    <span class="comment">//4.2 获取输入与输出之间的连接 设置</span></span><br><span class="line">    [<span class="keyword">self</span> setConnection:output];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(<span class="keyword">void</span>)setConnection:(<span class="built_in">AVCaptureVideoDataOutput</span> *)output&#123;</span><br><span class="line">    <span class="comment">// 桥接</span></span><br><span class="line">    <span class="built_in">AVCaptureConnection</span> *connection = [output connectionWithMediaType:<span class="built_in">AVMediaTypeVideo</span>];</span><br><span class="line">    connection.videoOrientation = <span class="built_in">AVCaptureVideoOrientationPortrait</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)addPreviewLayer&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 预览layer</span></span><br><span class="line">    <span class="built_in">AVCaptureVideoPreviewLayer</span> *previewLayer = [<span class="built_in">AVCaptureVideoPreviewLayer</span> layerWithSession:<span class="keyword">self</span>.session];</span><br><span class="line">    [<span class="keyword">self</span>.view.layer addSublayer:previewLayer];</span><br><span class="line">    _previewLayer = previewLayer;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 代理</span></span><br><span class="line">- (<span class="keyword">void</span>)captureOutput:(<span class="built_in">AVCaptureOutput</span> *)output didOutputSampleBuffer:(<span class="built_in">CMSampleBufferRef</span>)sampleBuffer fromConnection:(<span class="built_in">AVCaptureConnection</span> *)connection &#123;</span><br><span class="line">    <span class="comment">// captureSession 会话如果没有强引用，这里不会得到执行</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取图片帧数据</span></span><br><span class="line">    <span class="comment">// 为媒体数据设置一个CMSampleBuffer的Core Video图像缓存对象</span></span><br><span class="line">    CVImageBufferRef imageBuffer = <span class="built_in">CMSampleBufferGetImageBuffer</span>(sampleBuffer);</span><br><span class="line">    <span class="built_in">UIImage</span> *image;</span><br><span class="line">    <span class="keyword">if</span> (@available(iOS <span class="number">9.0</span>, *)) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">CIImage</span> *ciImage = [<span class="built_in">CIImage</span> imageWithCVImageBuffer:imageBuffer];</span><br><span class="line">        image = [<span class="built_in">UIImage</span> imageWithCIImage:ciImage];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        image = [<span class="keyword">self</span> imageFromSampleBuffer:imageBuffer];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        <span class="keyword">self</span>.imageView.image = image;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// iOS9.0 图片处理</span></span><br><span class="line">-(<span class="built_in">UIImage</span> *)imageFromSampleBuffer:(CVImageBufferRef)imageBuffer&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 锁定pixel buffer的基地址</span></span><br><span class="line">    CVPixelBufferLockBaseAddress(imageBuffer, <span class="number">0</span>);</span><br><span class="line">    <span class="comment">// 得到pixel buffer的基地址</span></span><br><span class="line">    <span class="keyword">void</span> *baseAddress = CVPixelBufferGetBaseAddress(imageBuffer);</span><br><span class="line">    <span class="comment">// 得到pixel buffer的行字节数</span></span><br><span class="line">    size_t bytesPerRow = CVPixelBufferGetBytesPerRow(imageBuffer);</span><br><span class="line">    <span class="comment">// 得到pixel buffer的宽和高</span></span><br><span class="line">    size_t width = CVPixelBufferGetWidth(imageBuffer);</span><br><span class="line">    size_t height = CVPixelBufferGetHeight(imageBuffer);</span><br><span class="line">    <span class="comment">// 创建一个依赖于设备的RGB颜色空间</span></span><br><span class="line">    <span class="built_in">CGColorSpaceRef</span> colorSpace = <span class="built_in">CGColorSpaceCreateDeviceRGB</span>();</span><br><span class="line">    <span class="comment">// 用抽样缓存的数据创建一个位图格式的图形上下文（graphics context）对象</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">CGBitmapContextCreate</span>(baseAddress, width, height, <span class="number">8</span>, bytesPerRow, colorSpace, kCGBitmapByteOrder32Little | kCGImageAlphaPremultipliedFirst);</span><br><span class="line">    <span class="comment">// 根据这个位图context中的像素数据创建一个Quartz image对象</span></span><br><span class="line">    <span class="built_in">CGImageRef</span> quartzImage = <span class="built_in">CGBitmapContextCreateImage</span>(context);</span><br><span class="line">    <span class="comment">// 解锁pixel buffer</span></span><br><span class="line">    CVPixelBufferUnlockBaseAddress(imageBuffer,<span class="number">0</span>);</span><br><span class="line">    <span class="comment">// 释放context和颜色空间</span></span><br><span class="line">    <span class="built_in">CGContextRelease</span>(context); <span class="built_in">CGColorSpaceRelease</span>(colorSpace);</span><br><span class="line">    <span class="comment">// 用Quartz image创建一个UIImage对象image</span></span><br><span class="line">    <span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageWithCGImage:quartzImage scale:<span class="number">1</span> orientation:<span class="built_in">UIImageOrientationUp</span>];</span><br><span class="line">    <span class="comment">// 释放Quartz image对象</span></span><br><span class="line">    <span class="built_in">CGImageRelease</span>(quartzImage);</span><br><span class="line">    <span class="keyword">return</span> (image);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)dealloc&#123;</span><br><span class="line"></span><br><span class="line">	[<span class="keyword">self</span>.session stopRunning];</span><br><span class="line">	<span class="keyword">self</span>.session = <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="切换镜头-amp-聚焦-amp-写入音视频"><a href="#切换镜头-amp-聚焦-amp-写入音视频" class="headerlink" title="切换镜头&amp;聚焦&amp;写入音视频"></a><font color="#037aff" face="黑体">切换镜头&amp;聚焦&amp;写入音视频</font></h2><h4 id="切换镜头"><a href="#切换镜头" class="headerlink" title="切换镜头"></a>切换镜头</h4><ul>
<li>切换步骤<ul>
<li>给切换过程添加动画</li>
<li>获取当前摄像头是前置还是后置</li>
<li>通过新摄像头（若之前是前置，则此次是后置）</li>
<li>通过新摄像头重新获取设备（AVCaptureDevice）</li>
<li>通过设备(AVCaptureDevice)创建新的输入(AVCaptureDeviceInput)</li>
<li>移除<code>旧input</code>并且添加<code>新Input</code><ul>
<li>注意：<code>修改session配置之前先调用开启修改配置选项，配置完成后，调用提交修改配置项</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="主要代码"><a href="#主要代码" class="headerlink" title="主要代码"></a>主要代码</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[session beginConfiguration];</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">   需要修改的配置信息</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">[session commitConfiguration];</span><br></pre></td></tr></table></figure>
<h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.input) &#123;</span><br><span class="line">        <span class="comment">//1 若当前是前置摄像头，则需新设后摄像头，反之，亦如此。</span></span><br><span class="line">        <span class="built_in">dispatch_async</span>(dispatch_get_global_queue(<span class="number">0</span>, <span class="number">0</span>), ^&#123;</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">AVCaptureDevicePosition</span> position  = (<span class="keyword">self</span>.input.device.position == <span class="built_in">AVCaptureDevicePositionFront</span>) ? <span class="built_in">AVCaptureDevicePositionBack</span> :<span class="built_in">AVCaptureDevicePositionFront</span>;</span><br><span class="line">            _curPosition = position;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 获取摄像头设备(前置 或者 后置 依据传入的 AVCaptureDevicePosition 而定)</span></span><br><span class="line">            <span class="built_in">AVCaptureDevice</span> *device = [<span class="keyword">self</span> cameroWithPosition:position];</span><br><span class="line">            </span><br><span class="line">  </span><br><span class="line">            <span class="built_in">NSError</span> *error;</span><br><span class="line">            <span class="built_in">AVCaptureDeviceInput</span> *newInput =  [<span class="built_in">AVCaptureDeviceInput</span> deviceInputWithDevice:device error:&amp;error];</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>(newInput) &#123;</span><br><span class="line">                </span><br><span class="line">                <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">                    </span><br><span class="line">                    <span class="built_in">CATransition</span> *rotaionAnim = [<span class="built_in">CATransition</span> animation];</span><br><span class="line">                    rotaionAnim.type = <span class="string">@"oglFlip"</span>;</span><br><span class="line">                    rotaionAnim.subtype = <span class="string">@"fromLeft"</span>;</span><br><span class="line">                    rotaionAnim.duration = <span class="number">0.5</span>;</span><br><span class="line">                    [<span class="keyword">self</span>.view.layer addAnimation:rotaionAnim forKey:<span class="literal">nil</span>];</span><br><span class="line">                    </span><br><span class="line">                    </span><br><span class="line">                    [<span class="keyword">self</span>.session beginConfiguration];</span><br><span class="line">                    <span class="comment">// 重设输入源</span></span><br><span class="line">                    [<span class="keyword">self</span>.session removeInput:<span class="keyword">self</span>.input];</span><br><span class="line">                    <span class="keyword">self</span>.input = newInput;</span><br><span class="line">                    [<span class="keyword">self</span>.session addInput:newInput];</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment">// 重设输出源</span></span><br><span class="line">                    [<span class="keyword">self</span>.session removeOutput:<span class="keyword">self</span>.output];</span><br><span class="line">                    [<span class="keyword">self</span> addCaptureDeviceOutput:device];</span><br><span class="line">                    </span><br><span class="line">                    [<span class="keyword">self</span>.session commitConfiguration];</span><br><span class="line">                &#125;);</span><br><span class="line">                </span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, error);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="左右成像问题"><a href="#左右成像问题" class="headerlink" title="左右成像问题"></a><code>左右成像问题</code></h4><ul>
<li>当使用前置摄像头时，注意左右成像问题。</li>
<li>需要在输出设备(<code>output</code>)的桥接(<code>AVCaptureVideoDataOutput</code>)设置一下镜像映射(照镜子效果)</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="keyword">void</span>)setConnection:(<span class="built_in">AVCaptureVideoDataOutput</span> *)output&#123;</span><br><span class="line">    <span class="comment">// 桥接</span></span><br><span class="line">    <span class="built_in">AVCaptureConnection</span> *connection = [output connectionWithMediaType:<span class="built_in">AVMediaTypeVideo</span>];</span><br><span class="line">    connection.videoOrientation = <span class="built_in">AVCaptureVideoOrientationPortrait</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 解决前置摄像头左右成像问题:(当前是前置摄像头 则启动镜子反射效果)</span></span><br><span class="line">    <span class="keyword">if</span> (_curPosition == <span class="built_in">AVCaptureDevicePositionUnspecified</span> || _curPosition == <span class="built_in">AVCaptureDevicePositionFront</span>) &#123;</span><br><span class="line">        connection.videoMirrored = <span class="literal">YES</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        connection.videoMirrored = <span class="literal">NO</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="写入文件"><a href="#写入文件" class="headerlink" title="写入文件"></a><font color="#037aff" face="黑体">写入文件</font></h2><h2 id="美颜滤镜效果"><a href="#美颜滤镜效果" class="headerlink" title="美颜滤镜效果"></a><font color="#037aff" face="黑体">美颜滤镜效果</font></h2><h4 id="GPUImage"><a href="#GPUImage" class="headerlink" title="GPUImage"></a>GPUImage</h4><ul>
<li><code>GPUImage</code> 是一个开源的基于GPU的图片或视频处理框架。其本身内置了多大120多种常见的滤镜效果</li>
<li><code>GPUImage</code> 是利用GPU，使在图片和视频上应用不同的效果和滤镜变得非常的容易。同时它还拥有出色的性能。并且它的性能要比苹果内置的相关API出色</li>
</ul>
<h4 id="高斯模糊-毛玻璃-效果"><a href="#高斯模糊-毛玻璃-效果" class="headerlink" title="高斯模糊(毛玻璃)效果"></a>高斯模糊(毛玻璃)效果</h4><ul>
<li>在iOS中实现毛玻璃效果方式有很多<ul>
<li><code>UIToolBar</code>本身有毛玻璃效果</li>
<li>iOS8之后<code>UIEffectView</code>直接创建毛玻璃View</li>
<li>系统<code>CoreImage</code>框架中直接修改图片</li>
<li><code>GPUImage</code>框架给图片添加一层滤镜</li>
</ul>
</li>
</ul>
<ul>
<li>用<code>GPUImage</code>实现毛玻璃效果思路<ul>
<li>获取要修改成毛玻璃的图片</li>
<li>给图片添加滤镜</li>
<li>生成新的图片</li>
</ul>
</li>
</ul>
<h4 id="实现代码"><a href="#实现代码" class="headerlink" title="实现代码"></a>实现代码</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="视频编码"><a href="#视频编码" class="headerlink" title="视频编码"></a><font color="#037aff" face="黑体">视频编码</font></h2><h2 id="iOS硬编码"><a href="#iOS硬编码" class="headerlink" title="iOS硬编码"></a><font color="#037aff" face="黑体">iOS硬编码</font></h2><h2 id="iOS软编码"><a href="#iOS软编码" class="headerlink" title="iOS软编码"></a><font color="#037aff" face="黑体">iOS软编码</font></h2><h2 id="YUV颜色空间"><a href="#YUV颜色空间" class="headerlink" title="YUV颜色空间"></a><font color="#037aff" face="黑体">YUV颜色空间</font></h2><h2 id="流媒体协议"><a href="#流媒体协议" class="headerlink" title="流媒体协议"></a><font color="#037aff" face="黑体">流媒体协议</font></h2><h2 id="推流"><a href="#推流" class="headerlink" title="推流"></a><font color="#037aff" face="黑体">推流</font></h2><h2 id="播放-1"><a href="#播放-1" class="headerlink" title="播放"></a><font color="#037aff" face="黑体">播放</font></h2><p>Demo地址：<a href="https://github.com/PggMan/VideoDemo" target="_blank" rel="noopener">音视频demo</a></p>

  </section>

  <section class="post-comments">

    <!-- 将评论系统（例如Disqus、多说、友言、畅言等）提供的代码片段粘贴在这里 -->
    
</section>


</article>


            <footer class="footer">

    <span class="footer__copyright">&copy; 2014-2015. | 由<a href="https://hexo.io/">Hexo</a>强力驱动 | 主题<a href="https://github.com/someus/huno">Huno</a></span>
    
</footer>
        </div>
    </div>

    <!-- js files -->
    <script src="/js/jquery.min.js"></script>
    <script src="/js/main.js"></script>
    <script src="/js/scale.fix.js"></script>
    

    

    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript"> 
        $(document).ready(function(){
            MathJax.Hub.Config({ 
                tex2jax: {inlineMath: [['[latex]','[/latex]'], ['\\(','\\)']]} 
            });
        });
    </script>


    

    <script src="/js/awesome-toc.min.js"></script>
    <script>
        $(document).ready(function(){
            $.awesome_toc({
                overlay: true,
                contentId: "post-content",
            });
        });
    </script>


    
    
    <!--kill ie6 -->
<!--[if IE 6]>
  <script src="//letskillie6.googlecode.com/svn/trunk/2/zh_CN.js"></script>
<![endif]-->

</body>
</html>
